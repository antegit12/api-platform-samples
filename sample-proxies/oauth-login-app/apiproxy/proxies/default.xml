<?xml version="1.0" encoding="UTF-8"?>
<ProxyEndpoint name="default">
	<Description>Default Proxy to create flows on an API</Description>
	<FaultRules />
	<Flows>
		<Flow name="SampleLoginPage">
			THIS IS A SAMPLE LOGIN PAGE.... In Production this flow has to be removed and the
			<Condition>(proxy.pathsuffix MatchesPath "/samplelogingpage") and (request.verb = "GET")</Condition>
			<Description />
			<Request>
				<Step>
					<Condition>(request.queryparam.response_type EQUALS "code")</Condition>
					<FaultRules />
					<Name>sample.loginpage.webserverflow</Name>
				</Step>
				<Step>
					<Condition>(request.queryparam.response_type EQUALS "token")</Condition>
					<FaultRules />
					<Name>sample.loginpage.implicitflow</Name>
				</Step>
			</Request>
		</Flow>
		<Flow name="authorize">
			<Condition>(proxy.pathsuffix MatchesPath "/authorize") and (request.verb = "GET")</Condition>
			<Description />
			<Request>
				<Step>
					<FaultRules />
					<Condition>(request.queryparam.response_type is empty)</Condition>
					<Name>MissingResponseTypeParameter</Name>
				</Step>
				<Step>
					<FaultRules />
					<Name>AuthorizationRequest</Name>
				</Step>
				<Step>
					<FaultRules />
					<Name>RedirectToLoginApp</Name>
				</Step>
			</Request>
		</Flow>
		<Flow name="authorizationcode">
			<Condition>(proxy.pathsuffix MatchesPath "/authorizationcode") and (request.verb = "GET") and (request.queryparam.response_type = "code")</Condition>
			<Description />
			<Request>
				<Step>
					<FaultRules />
					<Name>GenerateAuthorizationCode</Name>
				</Step>
			</Request>
			<Response>
				<Step>
					<FaultRules />
					<Name>AuthorizationCodeResponse</Name>
				</Step>
			</Response>
		</Flow>
		<Flow name="token">
			<Condition>(proxy.pathsuffix MatchesPath "/token")</Condition>
			<Description />
			<Request>
				<Step>
					<FaultRules />
					<Name>DeleteForwardedHeaders</Name>
				</Step>
				<Step>
					<FaultRules />
					<Condition>request.queryparam.response_type = "token"</Condition>
					<Name>GenerateAccessTokenImplicitGrant</Name>
				</Step>
				<Step>
					<FaultRules />
					<Condition>not (request.queryparam.response_type = "token")</Condition>
					<Name>GenerateAccessToken</Name>
				</Step>
			</Request>
		</Flow>
	</Flows>
	<PreFlow name="PreFlow" />
	<HTTPProxyConnection>
		<BasePath>/oauth</BasePath>
		<Properties />
		<VirtualHost>secure</VirtualHost>
	</HTTPProxyConnection>
	<RouteRule name="NoRoute" />
</ProxyEndpoint>
